<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Nhận diện khuôn mặt</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* đổ bóng chữ */
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.25);
        }
        /*tự tạo shadow đậm */
        .custom-shadow {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2), 0 0 10px rgba(0, 0, 0, 0.1);
        }
        /*chỉ tạo shadow khi hover*/
        .custom-shadow-hv {
            box-shadow: 0 0 0 rgba(76, 7, 215, 0.747);
            transition:box-shadow 0.5s ease;
        }
        .custom-shadow-hv:hover {
            box-shadow: 0 4px 10px rgba(76, 7, 215, 0.747), 0 4px 15px rgba(76, 7, 215, 0.496);
           
        }
        .parent:hover .custom-shadow-hv {
            box-shadow: 0 4px 10px rgba(76, 7, 215, 0.747), 0 4px 15px rgba(76, 7, 215, 0.496);
        }
        .parent:hover .child-text {
            color: #0863f7;
        }
        /* hiệu ứng mở trang*/
        .fade-in {
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards; 
        }
        @keyframes fadeIn {
            0% {
            opacity: 0;
            }
            100% {
            opacity: 1;
            }
        }
         /* hiệu ứng chữ */
        .underline-hover {
            position: relative;
        }
        .underline-hover::after {
            content: "";
            position: absolute;
            display: block;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: #3b82f6; 
            transition: width 0.7s;
        }

        .underline-hover:hover::after {
            width: 100%;
        }
    </style>
    
</head>

<body class="bg-white text-gray-900 font-sans fade-in">
                <!-- Bảng xanh dương trên cùng -->
    <div class="max-w-full max-h-full py-0 px-6 bg-blue-500 rounded-b-xl mx-auto">
        <div class="py-2.5 flex items-center">
            <img src="static/brand.png" alt="Icon" class="w-[17%] h-auto cursor-pointer" onclick="window.location.reload()">
            <div class="text-white flex ml-20 space-x-2 pt-1">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                    <path d="M11.7 2.805a.75.75 0 0 1 .6 0A60.65 60.65 0 0 1 22.83 8.72a.75.75 0 0 1-.231 1.337 49.948 49.948 0 0 0-9.902 3.912l-.003.002c-.114.06-.227.119-.34.18a.75.75 0 0 1-.707 0A50.88 50.88 0 0 0 7.5 12.173v-.224c0-.131.067-.248.172-.311a54.615 54.615 0 0 1 4.653-2.52.75.75 0 0 0-.65-1.352 56.123 56.123 0 0 0-4.78 2.589 1.858 1.858 0 0 0-.859 1.228 49.803 49.803 0 0 0-4.634-1.527.75.75 0 0 1-.231-1.337A60.653 60.653 0 0 1 11.7 2.805Z" />
                    <path d="M13.06 15.473a48.45 48.45 0 0 1 7.666-3.282c.134 1.414.22 2.843.255 4.284a.75.75 0 0 1-.46.711 47.87 47.87 0 0 0-8.105 4.342.75.75 0 0 1-.832 0 47.87 47.87 0 0 0-8.104-4.342.75.75 0 0 1-.461-.71c.035-1.442.121-2.87.255-4.286.921.304 1.83.634 2.726.99v1.27a1.5 1.5 0 0 0-.14 2.508c-.09.38-.222.753-.397 1.11.452.213.901.434 1.346.66a6.727 6.727 0 0 0 .551-1.607 1.5 1.5 0 0 0 .14-2.67v-.645a48.549 48.549 0 0 1 3.44 1.667 2.25 2.25 0 0 0 2.12 0Z" />
                    <path d="M4.462 19.462c.42-.419.753-.89 1-1.395.453.214.902.435 1.347.662a6.742 6.742 0 0 1-1.286 1.794.75.75 0 0 1-1.06-1.06Z" />
                </svg>
                <span class="font-bold text-lg">CNPM: nhóm 3</span>
                <span class="text-gray-300 text-ml">|</span>
                <a href="https://github.com/vutlx13/CNPM-project" target="_blank" class="text-red-100 cursor-pointer">Git: CNPM-Project</a>
            </div>

            <div class="text-white flex ml-[950px] space-x-5 pt-1">
                <div class="relative">
                    <svg onclick="document.getElementById('tin_nhan').classList.toggle('hidden')" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="-5 -5 35 35" stroke-width="1.5" stroke="currentColor" class="size-10 rounded-3xl hover:bg-blue-600 hover:scale-[1.2] transition-transform cursor-pointer">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z" />
                    </svg>
                    <div id="tin_nhan" class="text-gray-600 text-[15px] flex items-center justify-center px-2 py-2 font-semibold custom-shadow rounded-lg absolute hidden bg-white h-[50px] w-[250px] left-[-230px] bottom-[-130%]">
                        Tính năng không khả dụng.
                    </div>
                </div>

                <div class="relative">
                    <svg onclick="document.getElementById('thong_bao').classList.toggle('hidden')" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="-7 -7 37 37" stroke-width="1.5" stroke="currentColor" class="size-10 rounded-3xl hover:bg-blue-600 hover:scale-[1.2] transition-transform cursor-pointer">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                    </svg>
                    <div id="thong_bao" class="text-gray-600 text-[15px] flex items-center justify-center px-2 py-2 font-semibold custom-shadow rounded-lg absolute hidden bg-white h-[50px] w-[250px] left-[-230px] bottom-[-130%]">
                        Bạn không có thông báo mới.
                    </div>                      
                </div>

                <svg onclick="window.location.href='/'" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="-8 -8 40 40" stroke-width="1.5" stroke="currentColor" class="size-10 rounded-3xl hover:bg-blue-600 hover:scale-[1.2] transition-transform cursor-pointer">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                </svg>                                           
            </div>
        </div>
    </div>

                            <!-- Chức năng-->
    <div class=" bg-white mx-auto min-h-[665px] flex h-auto pt-10 px-6 space-x-20">
        <!-- ==== Chụp ảnh từ camera ==== -->
         <div>
            <section class="mb-5 ml-[250px] w-[600px] mt-10 bg-white p-6 rounded-xl shadow-xl">
                <h2 class="text-xl font-semibold mb-4">📷 Chụp ảnh bằng camera</h2>
                <div class="flex flex-col md:flex-row gap-4 justify-center">
                    <!-- Bên trái: camera + nút -->
                    <div class="text-center">
                        <video id="camera" autoplay playsinline width="300" class="rounded hidden mx-auto"></video>
                        <canvas id="canvas" class="hidden"></canvas>
                        <div class="mt-2 space-x-2">
                            <button id="toggleCameraBtn" onclick="toggleCamera()" class="bg-green-700 text-white font-semibold px-4 py-2 rounded hover:bg-green-900 hover:shadow-2xl hover:scale-[1.05] transition-all">Bật/Tắt Camera</button>
                            <button onclick="chupAnh()" id="chupNút" class="bg-blue-700 text-white font-semibold px-4 py-2 rounded hover:bg-blue-900 hover:shadow-2xl cursor-pointer hover:scale-[1.05] transition-all" disabled>Chụp ảnh</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>

            <!-- Vạch kẻ dọc ẩn -->
        <div class="flex mb-60 items-center max-h-full ">
            <div class="bg-white w-[1px] h-[200px]"></div>
        </div>

        <!-- Bên phải: ảnh đã chụp -->
        <div>
            <section id="previewWrapper" class="text-center h-[365px] hidden mt-10 w-[600px] bg-white p-6 rounded-xl shadow-xl">
                <p class="text-xl text-gray-900 font-semibold mb-2">📸 Ảnh đã chụp:</p>
                <img id="preview_image" width="300" class="rounded border mx-auto">
            </section>
        </div>
    </div>
                <!--Phần nền xanh đáy-->
    <div class="bg-[#cce0fb] h-[180px] w-full rounded-t-3xl "></div>

    <script>
        const video = document.getElementById('camera');
        const canvas = document.getElementById('canvas');
        const previewImage = document.getElementById('preview_image');
        const chupNut = document.getElementById('chupNút');
        let stream = null;

        // Bật/Tắt Camera
        async function toggleCamera() {
            if (stream) {
                // Tắt camera
                stream.getTracks().forEach(track => track.stop());
                video.classList.add('hidden');
                chupNut.disabled = true;
                toggleCameraBtn.classList.remove('bg-red-700','hover:bg-red-900'); // Khôi phục màu ban đầu
                toggleCameraBtn.classList.add('bg-green-700','hover:bg-green-900'); // Màu ban đầu
                stream = null;
            } else {
                // Bật camera
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    video.srcObject = stream;
                    video.classList.remove('hidden');
                    chupNut.disabled = false;
                    toggleCameraBtn.classList.remove('bg-green-700','hover:bg-green-900'); // Khôi phục màu ban đầu
                    toggleCameraBtn.classList.add('bg-red-700','hover:bg-red-900');
                } catch (err) {
                    alert('Không thể truy cập camera: ' + err.message);
                }
            }
        }

        // Chụp ảnh và gửi lên server
        const previewWrapper = document.getElementById('previewWrapper');
        function chupAnh() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            canvas.toBlob(blob => {
                const file = new File([blob], "camera.png", { type: "image/png" });
                const formData = new FormData();
                formData.append('camera_image', file);

                fetch('/camera', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (!response.ok) throw new Error('Lỗi từ server');
                    return response.blob();
                })
                .then(blob => {
                    const imgURL = URL.createObjectURL(blob);
                    previewImage.src = imgURL;
                    previewImage.classList.remove('hidden');
                    previewWrapper.classList.remove('hidden'); // hiện ảnh sau khi chụp
                })
                .catch(err => {
                    alert('Không thể gửi ảnh: ' + err.message);
                    console.error(err);
                });
            }, 'image/png');
        }
    </script>
</body>